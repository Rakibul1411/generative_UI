<div class="min-h-screen bg-gray-50 px-4 py-10">
  <div class="max-w-5xl mx-auto space-y-8">
    <!-- Header -->
    <header class="text-center space-y-3">
      <p class="text-sm font-semibold text-green-600 tracking-wide uppercase">AI powered form builder</p>
      <h1 class="text-3xl md:text-4xl font-semibold text-gray-900">Create your form</h1>
      <p class="text-sm md:text-base text-gray-500">Describe the fields you need and let the backend craft the schema.</p>
    </header>

    <!-- Prompt composer -->
  <section class="card-panel p-6 space-y-5">
      <div class="space-y-2">
        <label for="prompt" class="text-sm font-medium text-gray-800">Form description</label>
        <textarea
          id="prompt"
          [(ngModel)]="prompt"
          rows="4"
          [disabled]="isLoading"
          class="w-full rounded-xl border border-gray-200 bg-gray-50 px-4 py-3 text-sm text-gray-800 placeholder:text-gray-400 focus:border-green-500 focus:ring-2 focus:ring-green-100 disabled:opacity-60"
          placeholder="e.g., Registration form with full name, email, password, age, preferred plan"
        ></textarea>
      </div>

      <div class="flex flex-col sm:flex-row gap-3">
        <button
          (click)="generateForm()"
          [disabled]="isLoading || !prompt.trim()"
          class="flex-1 rounded-xl bg-green-600 px-5 py-3 text-sm font-semibold text-white transition hover:bg-green-700 disabled:opacity-60"
        >
          {{ isLoading ? 'Generatingâ€¦' : 'Generate form schema' }}
        </button>
        <button
          (click)="clearResults()"
          *ngIf="generatedSchema || error || apiResponse"
          [disabled]="isLoading"
          class="rounded-xl border border-gray-300 px-5 py-3 text-sm font-semibold text-gray-700 transition hover:bg-gray-100 disabled:opacity-60"
        >
          Reset
        </button>
      </div>
    </section>

    <!-- Error Section -->
    <div *ngIf="error" class="rounded-2xl border border-red-200 bg-white p-5 text-sm text-red-700 shadow-sm">
      {{ error }}
    </div>

    <!-- Results Section -->
    <div *ngIf="generatedSchema" class="space-y-8">
      <!-- Dynamic Form -->
  <section class="card-panel p-6 sm:p-10">
        <div class="space-y-1">
          <p class="text-xs font-semibold uppercase text-green-600">Generated layout</p>
          <h2 class="text-2xl font-semibold text-gray-900">{{ generatedSchema.title || 'Generated form' }}</h2>
          <p *ngIf="generatedSchema.description" class="text-sm text-gray-500">{{ generatedSchema.description }}</p>
        </div>

        <form *ngIf="dynamicForm" [formGroup]="dynamicForm" (ngSubmit)="onSubmitDynamicForm()" class="mt-8 space-y-6">
          <div class="space-y-5 max-w-3xl mx-auto">
          <div *ngFor="let field of generatedSchema.fields; trackBy: trackByFieldName" class="field-card space-y-2">
            <div class="flex items-center gap-2">
              <label class="text-sm font-medium text-gray-800" [attr.for]="field.name">{{ field.label }}</label>
              <span *ngIf="field.required" class="text-xs font-semibold text-red-500">*</span>
            </div>
            <div [ngSwitch]="field.type">
              <input
                *ngSwitchCase="'text'"
                type="text"
                [id]="field.name"
                class="input-field"
                [attr.aria-label]="field.label"
                placeholder="{{ field.placeholder || ('Enter ' + field.label.toLowerCase()) }}"
                title="{{ field.placeholder || field.label }}"
                [formControlName]="field.name"
              />

              <input
                *ngSwitchCase="'email'"
                type="email"
                [id]="field.name"
                class="input-field"
                [attr.aria-label]="field.label"
                placeholder="{{ field.placeholder || ('Enter ' + field.label.toLowerCase()) }}"
                title="{{ field.placeholder || field.label }}"
                [formControlName]="field.name"
              />

              <input
                *ngSwitchCase="'password'"
                type="password"
                [id]="field.name"
                class="input-field"
                [attr.aria-label]="field.label"
                placeholder="{{ field.placeholder || ('Enter ' + field.label.toLowerCase()) }}"
                title="{{ field.placeholder || field.label }}"
                [formControlName]="field.name"
              />

              <input
                *ngSwitchCase="'number'"
                type="number"
                [id]="field.name"
                class="input-field"
                [attr.aria-label]="field.label"
                placeholder="{{ field.placeholder || ('Enter ' + field.label.toLowerCase()) }}"
                title="{{ field.placeholder || field.label }}"
                [formControlName]="field.name"
              />

              <input
                *ngSwitchCase="'tel'"
                type="tel"
                [id]="field.name"
                class="input-field"
                [attr.aria-label]="field.label"
                placeholder="{{ field.placeholder || ('Enter ' + field.label.toLowerCase()) }}"
                title="{{ field.placeholder || field.label }}"
                [formControlName]="field.name"
              />

              <input
                *ngSwitchCase="'url'"
                type="url"
                [id]="field.name"
                class="input-field"
                [attr.aria-label]="field.label"
                placeholder="{{ field.placeholder || ('Enter ' + field.label.toLowerCase()) }}"
                title="{{ field.placeholder || field.label }}"
                [formControlName]="field.name"
              />

              <input
                *ngSwitchCase="'date'"
                type="date"
                [id]="field.name"
                class="input-field"
                [attr.aria-label]="field.label"
                title="{{ field.label }}"
                [formControlName]="field.name"
              />

              <input
                *ngSwitchCase="'time'"
                type="time"
                [id]="field.name"
                class="input-field"
                [attr.aria-label]="field.label"
                title="{{ field.label }}"
                [formControlName]="field.name"
              />

              <input
                *ngSwitchCase="'datetime-local'"
                type="datetime-local"
                [id]="field.name"
                class="input-field"
                [attr.aria-label]="field.label"
                title="{{ field.label }}"
                [formControlName]="field.name"
              />

              <textarea
                *ngSwitchCase="'textarea'"
                [id]="field.name"
                class="input-field"
                rows="3"
                [attr.aria-label]="field.label"
                placeholder="{{ field.placeholder || ('Enter ' + field.label.toLowerCase()) }}"
                title="{{ field.placeholder || field.label }}"
                [formControlName]="field.name"
              ></textarea>

              <select
                *ngSwitchCase="'select'"
                [id]="field.name"
                class="input-field"
                [attr.aria-label]="field.label"
                title="{{ field.label }}"
                [formControlName]="field.name"
              >
                <option value="" disabled>{{ field.placeholder || 'Select ' + field.label.toLowerCase() }}</option>
                <option *ngFor="let option of field.options || []" [value]="option">{{ option }}</option>
              </select>

              <div *ngSwitchCase="'radio'" class="space-y-2">
                <label *ngFor="let option of field.options || []" class="flex items-center gap-2 text-sm text-gray-700">
                  <input type="radio" [value]="option" [formControlName]="field.name" [attr.title]="option" class="accent-green-600" />
                  <span>{{ option }}</span>
                </label>
              </div>

              <div *ngSwitchCase="'checkbox'" class="space-y-2" [formArrayName]="field.name">
                <label *ngFor="let option of getCheckboxOptions(field.name); let idx = index" class="flex items-center gap-2 text-sm text-gray-700">
                  <input type="checkbox" [formControlName]="idx" (change)="onCheckboxGroupChange(field.name)" [attr.title]="option" class="accent-green-600" />
                  <span>{{ option }}</span>
                </label>
              </div>

              <input
                *ngSwitchDefault
                type="text"
                [id]="field.name"
                class="input-field"
                [attr.aria-label]="field.label"
                placeholder="{{ field.placeholder || ('Enter ' + field.label.toLowerCase()) }}"
                title="{{ field.placeholder || field.label }}"
                [formControlName]="field.name"
              />
            </div>

            <p *ngIf="field.hint" class="text-xs text-gray-500">{{ field.hint }}</p>
            <p *ngIf="hasFieldError(field.name)" class="text-xs font-medium text-red-500">{{ getFieldError(field.name) }}</p>
          </div>
          </div>

          <div class="flex flex-col sm:flex-row gap-3 pt-2 max-w-3xl mx-auto">
            <button type="submit" class="flex-1 rounded-lg bg-green-600 px-4 py-2.5 text-sm font-semibold text-white shadow hover:bg-green-700">
              {{ submitButtonText }}
            </button>
            <button type="button" (click)="resetDynamicForm()" class="rounded-lg border border-gray-300 px-4 py-2.5 text-sm font-semibold text-gray-700 shadow hover:bg-gray-100">
              Reset form
            </button>
          </div>
        </form>
      </section>

      <!-- Submitted Values Preview -->
  <section *ngIf="submittedValues" class="card-panel p-6">
        <h2 class="text-base font-semibold text-gray-900">Latest submission</h2>
        <pre class="mt-4 max-h-80 overflow-auto rounded-xl bg-gray-900 p-4 text-xs text-green-200">{{ submittedValues | json }}</pre>
      </section>

  <section class="card-panel p-6">
        <h2 class="text-base font-semibold text-gray-900">Raw API response</h2>
        <pre class="mt-4 max-h-80 overflow-auto rounded-xl bg-gray-900 p-4 text-xs text-gray-100">{{ apiResponse | json }}</pre>
      </section>

  <section *ngIf="apiResponse?.meta" class="card-panel p-6">
        <h3 class="text-base font-semibold text-gray-900 mb-4">Generation details</h3>
        <div class="space-y-3 text-sm text-gray-600">
          <div class="flex items-center justify-between">
            <span>Fields generated</span>
            <strong class="text-gray-900">{{ apiResponse?.meta?.fieldsCount }}</strong>
          </div>
          <div class="flex items-center justify-between">
            <span>Generated at</span>
            <strong class="text-gray-900">{{ apiResponse?.meta?.generatedAt | date:'medium' }}</strong>
          </div>
        </div>
      </section>
    </div>
  </div>
</div>
